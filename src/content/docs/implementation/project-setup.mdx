---
title: Project setup
description: Learn the differences in implementing Edge Delivery Services projects with Adobe Commerce. Setup includes CDN configuration, caching validation, Commerce dropins, and custom blocks.
---

This section highlights the differences during the implementation phase compared to normal Edge Delivery projects.

## Project Kickoff

* Start project from Commerce boilerplate
  * Repository: [Edge Delivery + Commerce boilerplate](https://github.com/hlxsites/aem-boilerplate-commerce)
  * This is a fork of the normal Edge Delivery boilerplate which includes additional code for Commerce

* Setup content source
  * For document-based authoring with SharePoint or Google Docs only
  * Content is available as release artifact https://github.com/hlxsites/aem-boilerplate-commerce/releases

## CDN setup

* Decide early which CDN to use. A popular option is Fastly, which is included with the Adobe Commerce license.

* Guidance on Fastly CDN configuration can be requested from the Adobe team via Slack. 

* Configure a subdomain for development (e.g. [aem.customer.com](http://aem.customer.com/)).
  * **Please ensure that this site is not crawl-able by search engines (e.g. via robots.txt).**

* Setup Edge Delivery CDN configuration according to documentation.
  * For cache invalidation, a Fastly API key is required. This key can be requested from Adobe Commerce support team.
  * Ensure compression (e.g. gzip) is correctly working.

* Proxy certain paths back to Adobe Commerce. This is specific to the project, but generally you should at least proxy the following paths:
  * Core GraphQL (e.g. https://customer-commerce/graphql → /graphql)
    * Ensure proper CORS headers are sent, so the endpoint can be accessed from hlx.page, hlx.live and localhost:3000 hosts.
  * Catalog Service / LiveSearch endpoints
    * Production: https://catalog-service.adobe.io/graphql → /cs-graphql
    * Sandbox: https://catalog-service-sandbox.adobe.io/graphql → /cs-graphql-sandbox
    * Please ensure to remove all cookies from requests as Catalog Service has a relatively small HTTP header limit
  * Product images coming from Adobe Commerce (e.g. /catalog/product/resized/200x200/3/_/3_1_1_12_2.jpeg)
  * Additional paths required for Luma Bridge.

* Cache Validation
  
  * It is fundamental that you validate that caching is working correctly. This should include requests with cookie headers and query parameters. 

   ```bash
   curl -sI -H 'Fastly-Debug: 1' https://www.bulk.com/uk/ | grep x-cache
 
   x-cache: MISS, HIT, HIT, HIT
   x-cache-hits: 0, 16, 102, 1
   ```
   * x-cache values are read right to left, where the rightmost value represents the customer CDN (Commerce Fastly). This value should indicate a cache HIT.

* Surrogate Key Validation
  * The default Adobe Commerce Fastly configuration overwrites surrogate keys set by Edge Delivery.

    ```bash
    curl -sI -H 'Fastly-Debug: 1' https://www.bulk.com/uk/ | grep surrogate-key
 
    surrogate-key: main--bul-eds--thepixel 401e079ea9d66cbdc48fc9bcd3a958206ef36cd2affcd6b672178e7628f RKvjyvNRGjNtCHP3 401e079ea9d66cbdc48fc9bcd3a958206ef36cd2affcd6b672178e7628f_metadata main--bul-eds--thepixel_head
    ```

    * When correctly set, the surrogate keys should include at least two ref-repo-org references as indicated in the example above.

## Setup Commerce config

* In the starter content, you will find a configs.xlsx file in the root folder. This file is used to expose configuration parameters to the frontend blocks.
* Update the configuration values with the customer specific Catalog Service header values.
* Update the configuration values with the Core GraphQL endpoint that was configured as part of the CDN setup.
* The required values are documented on https://experienceleague.adobe.com/developer/commerce/storefront/references/configurations/.

## Add Commerce dropins / widgets

* Depending on the outcome of the discovery phase, you can add dropins and widgets to the project.
* You can find the integration patterns for dropins and widgets as pull requests in the [Edge Delivery + Commerce repository](https://github.com/hlxsites/aem-boilerplate-commerce).
  * The PLP/Search and autocomplete widgets can be fully customized. Feel free to create project specific forks.
    * https://github.com/adobe/storefront-product-listing-page
    * Boilerplate uses the following fork with more optimizations: https://github.com/herzog31/storefront-product-listing-page
      * https://github.com/adobe/storefront-search-as-you-type
      * Please consider open PRs which might contain unmerged improvements for Edge Delivery.

* The source code of dropins is internal. You can add them to your project as npm packages.
  * `@dropins/storefront-cart`
  * `@dropins/storefront-checkout`
  * `@dropins/storefront-auth`
  * `@dropins/storefront-order-confirmation`
  * `@dropins/storefront-pdp`
  * `@dropins/tools`
  * It is recommended to use the documented extension patterns for the dropins. You can find the documentation at https://experienceleague.adobe.com/developer/commerce/storefront/product-details/pdp-introduction/.

* If dropins and widgets cannot be used, please use the custom PDP and PLP/Search blocks that come with the Edge Delivery + Commerce boilerplate.

* URL format of catalog pages

  * By default the boilerplate uses [folder mapping](https://www.aem.live/developer/folder-mapping) for product detail pages (PDP) and dedicated pages for product list pages (PLP).
  * If the customer catalog has a large amount of PLPs, it might make sense to use folder mapping also for PLPs. While a low number of PDPs or PLPs could justify creating dedicated pages for each.
  * The URL format for folder mapped PDPs looks like this: `/products/{urlKey}/{sku}`. This is to include the SEO relevant urlKey parameter and the SKU which is needed to perform Catalog Service queries. Feel free to customize the format as needed. Advanced customization might have to be done on CDN.
  * Be aware that Edge Delivery does not like URLs with uppercase letters which might cause issues when customers using uppercase characters in SKUs.
    * URLs generated by Edge Delivery (e.g. index) will always be fully lowercase.
    * Product detail page URLs with uppercase letters will however fully work.

## Implement Commerce blocks

* Compared to content blocks, blocks that enable Commerce functionality (e.g. minicart, product teaser, recommendations) can become quite complex.

* Usage of a frontend framework can help with managing the complexity.
  * In the boilerplate you can find examples of blocks that use a [buildless](https://preactjs.com/guide/v10/getting-started/#no-build-tools-route) version of [Preact](https://preactjs.com/) and [HTM](https://github.com/developit/htm).
  * Only use it for blocks that require complex state management with different render states. Otherwise stick with plain JavaScript.
  * Use existing blocks in Commerce boilerplate as reference (e.g. teaser and product recommendations).

* If you want to use React, this is possible, but not recommended. React is usually too heavy (size + execution) to achieve perfect lighthouse scores.